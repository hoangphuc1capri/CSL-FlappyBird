<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Flappy Qu·∫ßy Tuy·ªÉn Sinh</title>
  <!-- Font Oswald -->
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(135deg, #1e1e1e, #2c2c2c);
      font-family: 'Oswald', sans-serif;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: 0 auto;
      width: 100%;
      height: auto;
      max-height: 100%;
      aspect-ratio: 9 / 16;
      object-fit: contain;
    }
    #scoreDisplay {
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font-size: 6vw;
      font-weight: 700;
      text-shadow: 3px 3px #000;
      pointer-events: none;
      user-select: none;
    }
    #overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.75);
      color: #ffeb3b;
      font-size: 20px;
      text-align: center;
      z-index: 5;
      backdrop-filter: blur(4px);
    }
    #overlay img { width: 120px; margin-bottom: 20px; }
    #overlay input {
      width: 80px; text-align: center; margin-top: 12px; padding: 4px;
      border: 1px solid #999; border-radius: 6px; font-size: 14px;
    }
    #startBtn {
      margin-top: 20px; padding: 12px 30px; font-size: 14px;
      font-family: 'Oswald', sans-serif; border: 2px solid #000; border-radius: 8px;
      background: #ff4081; color: #fff; cursor: pointer;
      text-shadow: 1px 1px #000; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      transition: 0.2s;
    }
    #startBtn:hover { background: #f50057; transform: scale(1.05); }
    #popup {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: #fff; color: #000; padding: 24px 36px; border-radius: 14px;
      font-size: 18px; text-align: center; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
      display: none; z-index: 10; animation: pop 0.4s ease;
    }
    #popup button {
      margin: 10px; padding: 8px 20px; font-family: 'Oswald', sans-serif;
      border: none; border-radius: 8px; background: #ff5722; color: #fff;
      cursor: pointer; font-size: 14px; transition: 0.2s;
    }
    #popup button:hover { transform: scale(1.05); }
    @keyframes pop {
      from { transform: translate(-50%, -50%) scale(0.6); opacity: 0; }
      to   { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    #jumpBtn {
      position: fixed; bottom: 30px; right: 30px; padding: 20px 30px;
      border-radius: 50%; border: none; background: #ff9800; color: #fff;
      font-size: 20px; font-weight: bold;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4); cursor: pointer; display: none; z-index: 6;
    }
    @media (max-width: 768px) { #jumpBtn { display: block; } }
  </style>
</head>
<body>
  <canvas id="game" width="400" height="600"></canvas>
  <div id="scoreDisplay">0</div>
  <div id="overlay">
    <img src="assets/logo.png" alt="Logo Game">
    <div style="font-size:22px;margin-bottom:10px;">üéÆ FLAPPY QU·∫¶Y TUY·ªÇN SINH üéÆ</div>
    <div>
      <label style="color:#fff;">M·ªëc nh·∫≠n qu√†: </label>
      <input type="number" id="rewardInput" value="10">
    </div>
    <button id="startBtn">B·∫ÆT ƒê·∫¶U</button>
  </div>
  <div id="popup"></div>
  <button id="jumpBtn">‚¨Ü</button>

<script>
  // √Çm thanh
  const jumpSound = new Audio("assets/jump.mp3");
  const pointSound = new Audio("assets/point.mp3");
  const gameOverSound = new Audio("assets/gameover.mp3");
  jumpSound.volume = 0.6; pointSound.volume = 0.6; gameOverSound.volume = 0.7;

  const cvs = document.getElementById("game"), ctx = cvs.getContext("2d");
  ctx.imageSmoothingEnabled = false;
  let frames = 0, running = false, score = 0, best = 0, rewardTarget = 10;

  // load images (PNG)
  const birdImg = new Image(); birdImg.src = "assets/bird.png";
  const pipeImg = new Image(); pipeImg.src = "assets/pipe.png";
  const bgImg = new Image(); bgImg.src = "assets/bg.png";

  const bird = {
    x: 50, y: 150, w: 32, h: 32,
    gravity: 9.8, velocity: 0, jump: 250,
    draw() { ctx.drawImage(birdImg, this.x, this.y, this.w, this.h); },
    update(dt) {
      this.velocity += this.gravity * dt;
      this.y += this.velocity * dt;
      if (this.y + this.h > cvs.height || this.y < 0) endGame();
    }
  };

  const pipes = [];
  const PIPE_WIDTH = 50;
  function addPipe() {
    let gap = 140;
    let topHeight = Math.random() * (cvs.height - gap - 120) + 40;
    pipes.push({ x: cvs.width, y: 0, w: PIPE_WIDTH, h: topHeight, passed: false });
    pipes.push({ x: cvs.width, y: topHeight + gap, w: PIPE_WIDTH, h: cvs.height - topHeight - gap, passed: false });
  }
  function drawPipes() { pipes.forEach(p => ctx.drawImage(pipeImg, p.x, p.y, p.w, p.h)); }
  function updatePipes(dt) {
    pipes.forEach(p => p.x -= 200 * dt);
    if (pipes.length && pipes[0].x + pipes[0].w < 0) pipes.splice(0, 2);
    if (frames % 100 === 0) addPipe();

    for (let i = 0; i < pipes.length; i += 2) {
      let topPipe = pipes[i];
      if (!topPipe.passed && topPipe.x + topPipe.w < bird.x) {
        topPipe.passed = true;
        score++;
        if (score > best) best = score;
        document.getElementById("scoreDisplay").textContent = score;
        pointSound.currentTime = 0; pointSound.play();
        if (score === rewardTarget) {
          running = false;
          showPopup("üéâ Ch√∫c m·ª´ng!<br>B·∫°n ƒë√£ ƒë·∫°t m·ªëc qu√† üéÅ<br>ƒêi·ªÉm: " + score);
        }
      }
    }
  }

  let lastTime = 0;
  function loop(timestamp) {
    if (!running) return;
    if (!lastTime) lastTime = timestamp;
    let dt = (timestamp - lastTime) / 1000; // gi√¢y
    lastTime = timestamp;

    frames++;
    ctx.clearRect(0, 0, cvs.width, cvs.height);
    ctx.drawImage(bgImg, 0, 0, cvs.width, cvs.height);

    bird.update(dt); bird.draw();
    updatePipes(dt); drawPipes();

    for (let p of pipes) {
      if (bird.x + bird.w > p.x && bird.x < p.x + p.w && bird.y + bird.h > p.y && bird.y < p.y + p.h) {
        endGame();
      }
    }
    requestAnimationFrame(loop);
  }

  function endGame() {
    if (!running) return;
    running = false;
    gameOverSound.currentTime = 0; gameOverSound.play();
    showPopup("üíÄ Game Over üíÄ<br>B·∫°n ƒëi qua ƒë∆∞·ª£c " + score + " c·ªôt!");
  }

  function showPopup(msg) {
    const popup = document.getElementById("popup");
    popup.innerHTML = `
      ${msg}
      <br>
      <button onclick="restartGame()">üîÑ Ch∆°i l·∫°i</button>
      <button onclick="goHome()">üè† V·ªÅ m√†n h√¨nh ch√≠nh</button>
    `;
    popup.style.display = "block";
  }

  function restartGame() {
    score = 0; frames = 0; pipes.length = 0;
    bird.y = 150; bird.velocity = 0;
    running = true;
    document.getElementById("popup").style.display = "none";
    document.getElementById("overlay").style.display = "none";
    document.getElementById("scoreDisplay").textContent = "0";
    rewardTarget = parseInt(document.getElementById("rewardInput").value) || 10;
    lastTime = 0;
    requestAnimationFrame(loop);
  }

  function goHome() {
    score = 0; frames = 0; pipes.length = 0;
    bird.y = 150; bird.velocity = 0;
    running = false;
    document.getElementById("popup").style.display = "none";
    document.getElementById("overlay").style.display = "flex";
    document.getElementById("scoreDisplay").textContent = "0";
  }

  // controls
  function jump() {
    if (running) {
      bird.velocity = -bird.jump;
      jumpSound.currentTime = 0; jumpSound.play();
    }
  }

  document.getElementById("startBtn").onclick = restartGame;
  document.addEventListener("keydown", e => { if (e.code === "Space") jump(); });
  cvs.addEventListener("click", jump);
  cvs.addEventListener("touchstart", jump);
  document.getElementById("jumpBtn").onclick = jump;
</script>
</body>
</html>
